<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!--bootstrap icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="../css/admin.css" />
    <script>
        $(document).ready(function(){
            //add options for new products category
            $.ajax({
                    url: 'http://localhost:8081/category',
                    type: 'GET', 
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success:function(data,textStatus,xhr){
                        if(data.length != 0){
                            //update options
                            inner_html = ''
                            $.each(data,function(i,data){
                                inner_html += `<option value="${data.categoryid}">${data.category}</option>`
                            })
                            document.getElementById("categoryselect").innerHTML = inner_html
                        }else{
                            console.log("an error has occured")
                        }
                    },
                    error:function(xhr,textStatus,errorThrown){
                        console.log("Error in getting categories")
                    }
                });


            $("#CategorySubmit").click(function(){
                var Categoryname =$('#CategoryName').val();
                var Categorydescription = $('#CategoryDescription').val();
                var data = "{\"category\":\""+Categoryname+"\", \"description\":\""+Categorydescription+"\"}";
                var tmpToken = localStorage.getItem('token');
                console.log(data)

                if(Categoryname == "" || Categorydescription == ""){
                    console.log("shit")
                    alert("input a valid categoryname and description")
                    return
                }
                //post category 
                $.ajax({
                    headers: {'authorization': 'Bearer '+tmpToken},
                    url: 'http://localhost:8081/category',
                    type: 'POST', 
                    data: data,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success:function(data,textStatus,xhr){
                        console.log("inside of success")
                        alert("updated")
                    },
                    error:function(xhr,textStatus,errorThrown){
                        console.log("asdasdasd")
                        if (errorThrown == "Unprocessable Entity"){
                            alert("category already exists")
                        }else{
                            console.log("Error in Adding cateogry")
                        }
                        
                    }
                });
                return false;
            
            });


            $("#ProductSubmit").click(function(){
                var productname =$('#ProductName').val();
                var categoryid = document.getElementById("categoryselect").value;
                var productbrand = $('#ProductBrand').val();
                var ProductPrice = $('#ProductPrice').val();
                var ProductDescription = $('#ProductDescription').val();
                console.log(categoryid)
                var data = `{"name":"${productname}", "categoryid":"${categoryid}", "description":"${ProductDescription}", "brand":"${productbrand}", "price":"${ProductPrice}"}`;
                console.log(data)
                //get token
                var tmpToken = localStorage.getItem('token');   
                //post category 
                $.ajax({
                    headers: {'authorization': 'Bearer '+tmpToken}, 
                    url: 'http://localhost:8081/product/',
                    type: 'POST', 
                    data: data,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success:function(data,textStatus,xhr){
                        console.log("inside of success")
                        alert("updated")
                    },
                    error:function(xhr,textStatus,errorThrown){
                        
                        if (errorThrown == "Unprocessable Entity"){
                            alert("Product already exists")
                        }else{
                            console.log("Error in Adding cateogry")
                        }
                        
                    }
                });
                
                //make sure that all are not null
            })
        })
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="http://localhost:3001/">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="http://localhost:3001/">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="#">Disabled</a>
            </li>
          </ul>
        
        </div>
      </nav>
    <header>
        <div class="bg_img"><h1 class="text-uppercase p-2 text-center">Manage Product</h1></div>
      </header>

      <div class="container">

        <div class="row">
          <div class="col-sm-6">

            <div class="row"></div>

            <!-- add new category -->
                <form >
                    <div class="form-outline">
                        <label class="form-label" for="name">Cateogry&nbsp;Name</label>
                        <input type="text" id="CategoryName" class="form-control" placeholder="Phones" required>
                        </div>
                        <div class = "form-group">
                            <label class="form-label" for="feedbacklong">Description</label>
                            <textarea class="form-control" id="CategoryDescription" rows="4" required></textarea>
                            
                        </div>
                        <div class = "form-group text-center"><button type="submit" class="btn btn-primary" id = "CategorySubmit">Submit</button></div>
                </form>
                </div>
        
        
          

            <div class="col-sm-6">
                    <form>
                        <div class="form-outline">
                            <label class="form-label" for="name">Name</label>
                            <input type="text" id="ProductName" class="form-control" placeholder="iPhone" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryselect">Category</label>
                                <select class="form-control" id="categoryselect">

                                </select>
                            </div>
                            <div class="form-outline">
                                <label class="form-label" for="ProductBrand">Brand</label>
                                <input type="text" id="ProductBrand" class="form-control" placeholder="Apple" required>
                            </div>
                            <div class="form-outline ">
                                <label class="form-label" for="ProductPrice">Price</label>
                                <input type="number" id="ProductPrice" class="form-control" placeholder="1999.99" required>
                            </div>
                            <div class = "form-group">
                                <label class="form-label" for="ProductDescription">Description</label>
                                <textarea class="form-control" id="ProductDescription" rows="4" required></textarea>
                                
                            </div>
                            <div class = "form-group text-center"><button type="submit" class="btn btn-primary" id = "ProductSubmit">Submit</button></div>
                    </form>

            <!-- add new products -->
                <div class = "row"></div>
            </div>
          
            
        </div>
    </div>
          

      
</body>
